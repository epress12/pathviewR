<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basics of data import and cleaning in pathviewR • pathviewR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basics of data import and cleaning in pathviewR">
<meta property="og:description" content="pathviewR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pathviewR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-import-cleaning.html">Basics of data import and cleaning in pathviewR</a>
    </li>
    <li>
      <a href="../articles/managing-frame-gaps.html">Managing frame gaps with pathviewR</a>
    </li>
    <li>
      <a href="../articles/optic_flow_functions.html">Estimating visual perceptions from tracking data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vbaliga/pathviewR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basics of data import and cleaning in pathviewR</h1>
                        <h4 class="author">Vikram B. Baliga</h4>
            
            <h4 class="date">2020-09-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vbaliga/pathviewR/blob/master/vignettes/data-import-cleaning.Rmd"><code>vignettes/data-import-cleaning.Rmd</code></a></small>
      <div class="hidden name"><code>data-import-cleaning.Rmd</code></div>

    </div>

    
    
<div id="data-import-via-pathviewr" class="section level2">
<h2 class="hasAnchor">
<a href="#data-import-via-pathviewr" class="anchor"></a>Data import via <code>pathviewR</code>
</h2>
<p>Our <code>read_</code> functions presently support <code>.csv</code> files exported from <a href="https://optitrack.com/products/motive/">Optitrack’s Motive</a> software as well as <code>.mat</code> files exported from <a href="https://github.com/strawlab/flydra">Flydra</a>.</p>
<p>Should you have data from other sources, please see the function <code><a href="../reference/as_viewr.html">as_viewr()</a></code> and the ACCOMPANYING VIGNETTE (LINK!).</p>
<p>We’ll start by loading <code>pathviewR</code> and <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co">## If you do not already have pathviewR installed:</span>
<span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("vbaliga/pathviewR")</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pathviewR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)</pre></body></html></div>
<div id="motive-csv-files" class="section level3">
<h3 class="hasAnchor">
<a href="#motive-csv-files" class="anchor"></a>Motive CSV files</h3>
<p><code>.csv</code> files exported from Motive can be imported via <code><a href="../reference/read_motive_csv.html">read_motive_csv()</a></code></p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">## Import the Motive example data included in </span>
<span class="co">## the package</span>

<span class="no">motive_data</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/read_motive_csv.html">read_motive_csv</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"pathviewR_motive_example_data.csv"</span>,
                <span class="kw">package</span> <span class="kw">=</span> <span class="st">'pathviewR'</span>)
  )

<span class="co">## This produces a tibble </span>
<span class="no">motive_data</span>
<span class="co">#&gt; # A tibble: 934 x 26</span>
<span class="co">#&gt;    frame time_sec device02_rotati… device02_rotati… device02_rotati…</span>
<span class="co">#&gt;    &lt;int&gt;    &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 72210     722.           0.135            -0.977          -0.112 </span>
<span class="co">#&gt;  2 72211     722.           0.0819           -0.978          -0.0991</span>
<span class="co">#&gt;  3 72212     722.           0.211            -0.973          -0.0939</span>
<span class="co">#&gt;  4 72213     722.           0.196            -0.972          -0.128 </span>
<span class="co">#&gt;  5 72214     722.           0.131            -0.975          -0.121 </span>
<span class="co">#&gt;  6 72215     722.           0.0935           -0.975          -0.105 </span>
<span class="co">#&gt;  7 72216     722.           0.180            -0.975          -0.106 </span>
<span class="co">#&gt;  8 72217     722.           0.164            -0.972          -0.149 </span>
<span class="co">#&gt;  9 72218     722.           0.120            -0.973          -0.149 </span>
<span class="co">#&gt; 10 72219     722.           0.155            -0.970          -0.120 </span>
<span class="co">#&gt; # … with 924 more rows, and 21 more variables: device02_rotation_w &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device02_position_x &lt;dbl&gt;, device02_position_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device02_position_z &lt;dbl&gt;, device02_mean_marker_error &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device03_rotation_x &lt;dbl&gt;, device03_rotation_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device03_rotation_z &lt;dbl&gt;, device03_rotation_w &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device03_position_x &lt;dbl&gt;, device03_position_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device03_position_z &lt;dbl&gt;, device03_mean_marker_error &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device05_rotation_x &lt;dbl&gt;, device05_rotation_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device05_rotation_z &lt;dbl&gt;, device05_rotation_w &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device05_position_x &lt;dbl&gt;, device05_position_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   device05_position_z &lt;dbl&gt;, device05_mean_marker_error &lt;dbl&gt;</span></pre></body></html></div>
<p>Metadata are stored as attributes. We won’t go through all of these, but here are a couple important ones.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">## E.g. to see the header of the original file:</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">motive_data</span>, <span class="st">"header"</span>)
<span class="co">#&gt;                 metadata                      value</span>
<span class="co">#&gt; 1         Format Version                       1.23</span>
<span class="co">#&gt; 2              Take Name  sept-18_mixed-group_16-30</span>
<span class="co">#&gt; 3             Take Notes                           </span>
<span class="co">#&gt; 4     Capture Frame Rate                 100.000000</span>
<span class="co">#&gt; 5      Export Frame Rate                 100.000000</span>
<span class="co">#&gt; 6     Capture Start Time 2019-09-18 04.30.02.695 PM</span>
<span class="co">#&gt; 7   Total Frames in Take                     190951</span>
<span class="co">#&gt; 8  Total Exported Frames                     190951</span>
<span class="co">#&gt; 9          Rotation Type                 Quaternion</span>
<span class="co">#&gt; 10          Length Units                     Meters</span>
<span class="co">#&gt; 11      Coordinate Space                     Global</span>

<span class="co">## Names of all marked objects:</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">motive_data</span>, <span class="st">"subject_names_simple"</span>)
<span class="co">#&gt; [1] "device02" "device03" "device05"</span>

<span class="co">## Types of data included</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">motive_data</span>, <span class="st">"data_types_simple"</span>)
<span class="co">#&gt; [1] "Rigid Body"</span>

<span class="co">## Frame rate</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">motive_data</span>, <span class="st">"frame_rate"</span>)
<span class="co">#&gt; [1] 100</span></pre></body></html></div>
</div>
<div id="flydra-matlab-files" class="section level3">
<h3 class="hasAnchor">
<a href="#flydra-matlab-files" class="anchor"></a>Flydra Matlab files</h3>
<p><code>.mat</code> files exported from Flydra can be imported via <code><a href="../reference/read_flydra_mat.html">read_flydra_mat()</a></code>.</p>
<p>Note that a subject name is required. Only one name can be added and it will be used throughout the resultant <code>tibble</code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">## Import the Flydra example data included in </span>
<span class="co">## the package</span>
<span class="no">flydra_data</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/read_flydra_mat.html">read_flydra_mat</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,
                <span class="st">"pathviewR_flydra_example_data.mat"</span>,
                <span class="kw">package</span> <span class="kw">=</span> <span class="st">'pathviewR'</span>),
    <span class="kw">subject_name</span> <span class="kw">=</span> <span class="st">"birdie_wooster"</span>
  )

<span class="co">## Similarly, this produces a tibble with important </span>
<span class="co">## metadata as attributes</span>
<span class="no">flydra_data</span>
<span class="co">#&gt; # A tibble: 7,744 x 6</span>
<span class="co">#&gt;    frame[,1] time_sec subject position_length… position_width[… position_height…</span>
<span class="co">#&gt;        &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1       746     0    birdie…            0.869         -0.00417             1.31</span>
<span class="co">#&gt;  2       747     0.01 birdie…            0.864         -0.00614             1.31</span>
<span class="co">#&gt;  3       748     0.02 birdie…            0.863         -0.00695             1.31</span>
<span class="co">#&gt;  4       749     0.03 birdie…            0.862         -0.00672             1.31</span>
<span class="co">#&gt;  5       750     0.04 birdie…            0.862         -0.00644             1.31</span>
<span class="co">#&gt;  6       751     0.05 birdie…            0.862         -0.00619             1.31</span>
<span class="co">#&gt;  7       752     0.06 birdie…            0.863         -0.00667             1.31</span>
<span class="co">#&gt;  8       753     0.07 birdie…            0.864         -0.00712             1.31</span>
<span class="co">#&gt;  9       754     0.08 birdie…            0.865         -0.00727             1.31</span>
<span class="co">#&gt; 10       755     0.09 birdie…            0.865         -0.00760             1.31</span>
<span class="co">#&gt; # … with 7,734 more rows</span></pre></body></html></div>
</div>
</div>
<div id="data-cleaning" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleaning" class="anchor"></a>Data cleaning</h2>
<p>Data exported via either Motive or Flydra are not typically “tidy”. Functions in <code>pathviewR</code> ultimately rely on having tidy data sets that are easily interpreted.</p>
<p>Several functions to clean and wrangle data are available, and we have a suggested pipeline for how these steps should be handled. The rest of this vignette will cover these steps.</p>
<p>All of the steps in the suggested pipeline are also covered by two all-in-one functions: <code><a href="../reference/clean_viewr.html">clean_viewr()</a></code> and <code><a href="../reference/import_and_clean_viewr.html">import_and_clean_viewr()</a></code>. See the section at the very end of this vignette for details.</p>
<p>And speaking of pipes, all functions in <code>pathviewR</code> are pipe-friendly. We will detail each step separately, but each of the subsequent steps may be piped, e.g. <code>data %&gt;% relabel_viewr_axes() %&gt;% gather_tunnel_data()</code> etc etc</p>
<div id="relabeling-axes-gathering-data-columns-and-trimming-outliers" class="section level3">
<h3 class="hasAnchor">
<a href="#relabeling-axes-gathering-data-columns-and-trimming-outliers" class="anchor"></a>Relabeling axes, gathering data columns, and trimming outliers</h3>
<p>Axis labels (x, y, z) may be applied in arbitrary ways by software. A user might intuitively think the z axis represents height, but the original software may label it as the y axis instead.</p>
<p><code>relabel_viewr_axes</code> provides a means to relabel axes with “tunnel_length”, “tunnel_width”, and “tunnel_height”. <strong>These axis labels will be expected by subsequent functions, so skipping this step is ill-advised.</strong></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">motive_relabeled</span> <span class="kw">&lt;-</span>
  <span class="no">motive_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/relabel_viewr_axes.html">relabel_viewr_axes</a></span>(
    <span class="kw">tunnel_length</span> <span class="kw">=</span> <span class="st">"_z"</span>,
    <span class="kw">tunnel_width</span> <span class="kw">=</span> <span class="st">"_x"</span>,
    <span class="kw">tunnel_height</span> <span class="kw">=</span> <span class="st">"_y"</span>,
    <span class="kw">real</span> <span class="kw">=</span> <span class="st">"_w"</span>
  )

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">motive_relabeled</span>)
<span class="co">#&gt;  [1] "frame"                      "time_sec"                  </span>
<span class="co">#&gt;  [3] "device02_rotation_width"    "device02_rotation_height"  </span>
<span class="co">#&gt;  [5] "device02_rotation_length"   "device02_rotation_real"    </span>
<span class="co">#&gt;  [7] "device02_position_width"    "device02_position_height"  </span>
<span class="co">#&gt;  [9] "device02_position_length"   "device02_mean_marker_error"</span>
<span class="co">#&gt; [11] "device03_rotation_width"    "device03_rotation_height"  </span>
<span class="co">#&gt; [13] "device03_rotation_length"   "device03_rotation_real"    </span>
<span class="co">#&gt; [15] "device03_position_width"    "device03_position_height"  </span>
<span class="co">#&gt; [17] "device03_position_length"   "device03_mean_marker_error"</span>
<span class="co">#&gt; [19] "device05_rotation_width"    "device05_rotation_height"  </span>
<span class="co">#&gt; [21] "device05_rotation_length"   "device05_rotation_real"    </span>
<span class="co">#&gt; [23] "device05_position_width"    "device05_position_height"  </span>
<span class="co">#&gt; [25] "device05_position_length"   "device05_mean_marker_error"</span></pre></body></html></div>
<p>Akin to the behavior of <code>dplyr::gather()</code>, <code><a href="../reference/gather_tunnel_data.html">gather_tunnel_data()</a></code> will take all data from a given session and organize it so that all data of a given type are within one column, i.e. all position lengths are in <code>position_length</code>, as opposed to separate length columns for each rigid body. <strong>These column names will be expected by subsequent functions, so skipping this step is also ill-advised.</strong></p>
<p>Use <code><a href="../reference/trim_tunnel_outliers.html">trim_tunnel_outliers()</a></code> to remove artifacts and other outlier data. This step is entirely optional, and should only be used when the user is confident that data outside certain ranges are artifacts or other bugs. Data outside these ranges are then filtered out. Best to plot data beforehand and check!!</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## First gather and show the new column names</span>
<span class="no">motive_gathered</span> <span class="kw">&lt;-</span>
  <span class="no">motive_relabeled</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/gather_tunnel_data.html">gather_tunnel_data</a></span>()

<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">motive_gathered</span>)
<span class="co">#&gt;  [1] "frame"             "time_sec"          "subject"          </span>
<span class="co">#&gt;  [4] "position_length"   "position_width"    "position_height"  </span>
<span class="co">#&gt;  [7] "rotation_length"   "rotation_width"    "rotation_height"  </span>
<span class="co">#&gt; [10] "rotation_real"     "mean_marker_error"</span>

<span class="co">## Now trim, using ranges we know to safely include data</span>
<span class="co">## and exclude artifacts. Anything outside these ranges </span>
<span class="co">## will be removed.</span>
<span class="no">motive_trimmed</span> <span class="kw">&lt;-</span>
  <span class="no">motive_gathered</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/trim_tunnel_outliers.html">trim_tunnel_outliers</a></span>(
    <span class="kw">lengths_min</span> <span class="kw">=</span> <span class="fl">0</span>,
    <span class="kw">lengths_max</span> <span class="kw">=</span> <span class="fl">3</span>,
    <span class="kw">widths_min</span> <span class="kw">=</span> -<span class="fl">0.4</span>,
    <span class="kw">widths_max</span> <span class="kw">=</span> <span class="fl">0.8</span>,
    <span class="kw">heights_min</span> <span class="kw">=</span> -<span class="fl">0.2</span>,
    <span class="kw">heights_max</span> <span class="kw">=</span> <span class="fl">0.5</span>
  )</pre></body></html></div>
</div>
<div id="standardization-of-tunnel-position-and-coordinates" class="section level3">
<h3 class="hasAnchor">
<a href="#standardization-of-tunnel-position-and-coordinates" class="anchor"></a>Standardization of tunnel position and coordinates</h3>
<p>The coordinate system of the tunnel itself may require adjustment or standardization. For example, data collected across different days may show slight differences in coordinate systems if calibration equipment was not used in identical ways. Moreover, the user may want to redefine how the coordinate system itself is defined (i.e. change the location of <code>(0, 0, 0)</code> to another place within the tunnel.</p>
<p>Note that having <code>(0, 0, 0)</code> set to the center of the tunnel is required for all subsequent <code>pathviewR</code> functions to work.</p>
<p><code>pathviewR</code> offers three main choices for such standardization:</p>
<ul>
<li><p><code><a href="../reference/redefine_tunnel_center.html">redefine_tunnel_center()</a></code>: Sets the location of 0 on any or all axes to a new location. See the Help page for this function to see the four different methods by which a user can specify this. No rotation of the tunnel is performed.</p></li>
<li><p><code><a href="../reference/standardize_tunnel.html">standardize_tunnel()</a></code>: Use specified landmarks (<code>subjects</code> within the <code>viewr</code> object) to rotate and translate the location of a tunnel, setting <code>(0, 0, 0)</code> to the center of the tunnel (centering).</p></li>
<li><p><code>rotate_tunnel</code>: Rotate and center a tunnel based on user-defined coordinates (i.e. similar to <code><a href="../reference/standardize_tunnel.html">standardize_tunnel()</a></code> but for cases where specified landmarks are not in the data).</p></li>
</ul>
<p>Two quick examples will follow, using our motive and Flydra data:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## Rotate and center the motive data set:</span>
<span class="no">motive_rotated</span> <span class="kw">&lt;-</span>
  <span class="no">motive_trimmed</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/rotate_tunnel.html">rotate_tunnel</a></span>(
    <span class="kw">perch1_len_min</span> <span class="kw">=</span> -<span class="fl">0.06</span>,
    <span class="kw">perch1_len_max</span> <span class="kw">=</span> <span class="fl">0.06</span>,
    <span class="kw">perch2_len_min</span> <span class="kw">=</span> <span class="fl">2.48</span>,
    <span class="kw">perch2_len_max</span> <span class="kw">=</span> <span class="fl">2.6</span>,
    <span class="kw">perch1_wid_min</span> <span class="kw">=</span> <span class="fl">0.09</span>,
    <span class="kw">perch1_wid_max</span> <span class="kw">=</span> <span class="fl">0.31</span>,
    <span class="kw">perch2_wid_min</span> <span class="kw">=</span> <span class="fl">0.13</span>,
    <span class="kw">perch2_wid_max</span> <span class="kw">=</span> <span class="fl">0.35</span>
  )</pre></body></html></div>
<p>In the above, virtual perches are defined by the user using the arguments shown. The center of each perch is then found and then the locations of the two perch centers are then used to 1) set <code>(0, 0, 0)</code> to the point that is equidistant from the perches (i.e. the middle of the tunnel) and 2) rotate the tunnel about the height axis so that both perch width coordinates are at 0. This may be easier to understand through plotting:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">## Quick (base-R) plot of the original data</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">motive_trimmed</span>$<span class="no">position_length</span>,
     <span class="no">motive_trimmed</span>$<span class="no">position_width</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/rotate_example_plots-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r">
<span class="co">## Quick (base-R) plot of the rotated data</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">motive_rotated</span>$<span class="no">position_length</span>,
     <span class="no">motive_rotated</span>$<span class="no">position_width</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/rotate_example_plots-2.png" width="700"></p>
<p>Differences due to rotation may be extremely subtle, but the redefining of <code>(0, 0, 0)</code> to the middle of the tunnel should be clear from contrasting the axes of the plots.</p>
<p>Flydra data typically do not need to be rotated, so we will instead use <code>redfine_tunnel_center()</code> to adjust the location of <code>(0, 0, 0)</code>:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## Re-center the Flydra data set:</span>
<span class="no">flydra_centered</span> <span class="kw">&lt;-</span>
  <span class="no">flydra_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/redefine_tunnel_center.html">redefine_tunnel_center</a></span>(<span class="kw">length_method</span> <span class="kw">=</span> <span class="st">"middle"</span>,
                         <span class="kw">height_method</span> <span class="kw">=</span> <span class="st">"user-defined"</span>,
                         <span class="kw">height_zero</span> <span class="kw">=</span> <span class="fl">1.44</span>)</pre></body></html></div>
<p>Here, we are using <code>length_method = "middle"</code> to use the middle of the range of “length” data to set length = 0 (a translation), making no change to the width axis, and then specifying that height = 0 should be equal to the value <code>1.44</code> from the original data (another translation). Again, plotting may help; note that this time, we’ll plot length x height (instead of width):</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co">## Quick (base-R) plot of the original data</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">flydra_data</span>$<span class="no">position_length</span>,
     <span class="no">flydra_data</span>$<span class="no">position_height</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/redefine_example_plots-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r">
<span class="co">## Quick (base-R) plot of the redefined data</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">flydra_centered</span>$<span class="no">position_length</span>,
     <span class="no">flydra_centered</span>$<span class="no">position_height</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/redefine_example_plots-2.png" width="700"></p>
</div>
<div id="selecting-a-region-of-interest" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-a-region-of-interest" class="anchor"></a>Selecting a region of interest</h3>
<p>This required step has benefits that are twofold: 1) treatment effects on animal movement may only manifest over certain regions of the tunnel, and 2) focusing on a subset of the data makes it easier to define explicit trajectories and run computations faster.</p>
<p>The region of interest is defined via the function <code><a href="../reference/select_x_percent.html">select_x_percent()</a></code>. Once tunnel coordinates have been standardized (via one of the function in the previous section), <code><a href="../reference/select_x_percent.html">select_x_percent()</a></code> then selects the middle <code>x</code> percent (along the length axis) of the tunnel as the region of interest. For example, selecting 50 percent would start from the center of the tunnel and move 25% of the tunnel along positive length and 25% along negative length values to then select the middle 50% of the tunnel.</p>
<p>Quick examples:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co">## Motive data: select the middle 50% of the tunnel as the region of interest</span>
<span class="no">motive_selected</span> <span class="kw">&lt;-</span>
  <span class="no">motive_rotated</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/select_x_percent.html">select_x_percent</a></span>(<span class="fl">50</span>)

<span class="co">## Quick plot:</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">motive_selected</span>$<span class="no">position_length</span>,
     <span class="no">motive_selected</span>$<span class="no">position_width</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/select_x_examples-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><html><body><pre class="r">
<span class="co">## Flydra data:</span>
<span class="no">flydra_selected</span> <span class="kw">&lt;-</span>
  <span class="no">flydra_centered</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/select_x_percent.html">select_x_percent</a></span>(<span class="fl">50</span>)

<span class="co">## Quick plot:</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">flydra_selected</span>$<span class="no">position_length</span>,
     <span class="no">flydra_selected</span>$<span class="no">position_width</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/select_x_examples-2.png" width="700"></p>
</div>
<div id="isolating-each-trajectory" class="section level3">
<h3 class="hasAnchor">
<a href="#isolating-each-trajectory" class="anchor"></a>Isolating each trajectory</h3>
<p>The <code>pathviewR</code> standard for defining a trajectory is: continuous movement from one side of the tunnel to the other over the span of the region of interest. Note that this definition does not strictly require linear movement from one end to the other; an animal could make several loops inside the region of interest within a given trajectory.</p>
<p>Isolating trajectories is handled via the <code><a href="../reference/separate_trajectories.html">separate_trajectories()</a></code> function in <code>pathviewR</code>. Note that a region of interest must be selected beforehand via <code><a href="../reference/select_x_percent.html">select_x_percent()</a></code>.</p>
<p>Because cameras may occasionally drop frames, we allow the user to permit some relaxation of how stringent the “continuous movement” criterion is. This is handled via the <code>max_frame_gap</code> argument within <code><a href="../reference/separate_trajectories.html">separate_trajectories()</a></code>. For more details, please see VIGNETTE XXX (LINK HERE).</p>
<p>In our Motive example, we’ll use the automated feature built into the function to guesstimate the best <code>max_frame_gap</code> allowed. When frame gaps larger than <code>max_frame_gap</code> are encountered, the function will force the defining of a new trajectory. But if frame gaps smaller than <code>max_frame_gap</code> are encountered, keeping observations within the same trajectory is permitted.</p>
<p>In the Flydra example, we’ll simply set <code>max_frame_gap</code> to <code>1</code> so that no frame gaps are allowed (movement must be continuous with no dropped frames).</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">motive_labeled</span> <span class="kw">&lt;-</span>
  <span class="no">motive_selected</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/separate_trajectories.html">separate_trajectories</a></span>(<span class="kw">max_frame_gap</span> <span class="kw">=</span> <span class="st">"autodetect"</span>)
<span class="co">#&gt; autodetect is an experimental feature -- please report issues.</span>

<span class="no">flydra_labeled</span> <span class="kw">&lt;-</span>
  <span class="no">flydra_selected</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/separate_trajectories.html">separate_trajectories</a></span>(<span class="kw">max_frame_gap</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
</div>
<div id="retain-only-complete-trajectories" class="section level3">
<h3 class="hasAnchor">
<a href="#retain-only-complete-trajectories" class="anchor"></a>Retain only complete trajectories</h3>
<p>Now that trajectories have been isolated and labeled, the final cleaning step is to retain only the trajectories that completely span from one end of the region of interest to the other.</p>
<p>This final step is handled via <code>pathviewR</code>’s <code><a href="../reference/get_full_trajectories.html">get_full_trajectories()</a></code>.</p>
<p>There is a built-in “fuzziness” feature: because trajectories may not have observations exactly at the beginning or the end of the region of interest, it may be necessary to allow trajectories to be slightly shorter than the range of the selected region of interest. The <code>span</code> parameter of this function handles this. By supplying a numeric proportion from <code>0</code> to <code>1</code>, a user may allow trajectories to span that proportion of the selected region. For example, setting <code>span = 0.95</code> will keep all trajectories that span 95% of the length of the selected region of interest. Setting <code>span = 1</code> (not recommended) will strictly keep trajectories that start and end at the <strong>exact</strong> cut-offs of the selected region of interest.</p>
<p>For these reasons, <code>span</code>s of <code>0.99</code> to <code>0.95</code> are generally recommended. The best choice ultimately depends on your capture frame rate as well as your own judgment. Should you desire to set it lower (which you can), you may instead consider using a smaller region of interest (i.e. set the <code>desired_percent</code> parameter in <code><a href="../reference/select_x_percent.html">select_x_percent()</a></code> to be lower).</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co">## Motive</span>
<span class="no">motive_full</span> <span class="kw">&lt;-</span>
  <span class="no">motive_labeled</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/get_full_trajectories.html">get_full_trajectories</a></span>(<span class="kw">span</span> <span class="kw">=</span> <span class="fl">0.95</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">motive_full</span>$<span class="no">position_length</span>,
     <span class="no">motive_full</span>$<span class="no">position_width</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">motive_full</span>$<span class="no">file_sub_traj</span>))</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/get_full_examples-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r">
<span class="co">## Flydra</span>
<span class="no">flydra_full</span> <span class="kw">&lt;-</span>
  <span class="no">flydra_labeled</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/get_full_trajectories.html">get_full_trajectories</a></span>(<span class="kw">span</span> <span class="kw">=</span> <span class="fl">0.95</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">flydra_full</span>$<span class="no">position_length</span>,
     <span class="no">flydra_full</span>$<span class="no">position_width</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">flydra_full</span>$<span class="no">file_sub_traj</span>))</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/get_full_examples-2.png" width="700"></p>
</div>
<div id="all-in-one-cleaning-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#all-in-one-cleaning-functions" class="anchor"></a>All-in-one cleaning functions</h3>
<p>All of the above steps can also be done by using <code>pathviewR</code>’s designated all-in-one functions. <code><a href="../reference/import_and_clean_viewr.html">import_and_clean_viewr()</a></code> imports raw data and allows the user to run through all of the cleaning steps previously covered in this vignette. <code><a href="../reference/clean_viewr.html">clean_viewr()</a></code> does the same on any object already imported into the R environment (i.e. it skips data import).</p>
<p>For both of these functions, all of the cleaning steps are set to <code>TRUE</code> by default, but may be turned off by using <code>FALSE</code>. Argument names correspond to standalone functions in <code>pathviewR</code>, and if the user wants to use non-default values for corresponding arguments, they should also be supplied for any steps that are set to <code>TRUE</code>.</p>
<p>For example, if the user keeps <code>select_x_percent = TRUE</code> as an argument in <code><a href="../reference/clean_viewr.html">clean_viewr()</a></code>, the <code><a href="../reference/select_x_percent.html">select_x_percent()</a></code> function is run internally. This means that should the user desire to select a region of interest that does not match the default value of 33 percent, an additional argument should be supplied to <code><a href="../reference/clean_viewr.html">clean_viewr()</a></code> as if it were being supplied to <code><a href="../reference/select_x_percent.html">select_x_percent()</a></code> itself, e.g.: <code>desired_percent = 50</code>.</p>
<p>All additional arguments should be written out fully and explicitly.</p>
<p>Here’s an example using what we previously covered:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">motive_allinone</span> <span class="kw">&lt;-</span>
  <span class="no">motive_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/clean_viewr.html">clean_viewr</a></span>(
    <span class="kw">relabel_viewr_axes</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">gather_tunnel_data</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">trim_tunnel_outliers</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">standardization_option</span> <span class="kw">=</span> <span class="st">"rotate_tunnel"</span>,
    <span class="kw">select_x_percent</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">desired_percent</span> <span class="kw">=</span> <span class="fl">50</span>,
    <span class="kw">rename_viewr_characters</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
    <span class="kw">separate_trajectories</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">max_frame_gap</span> <span class="kw">=</span> <span class="st">"autodetect"</span>,
    <span class="kw">get_full_trajectories</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">span</span> <span class="kw">=</span> <span class="fl">0.95</span>
  )
<span class="co">#&gt; autodetect is an experimental feature -- please report issues.</span>

<span class="co">## Quick plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">motive_allinone</span>$<span class="no">position_length</span>,
     <span class="no">motive_allinone</span>$<span class="no">position_width</span>,
     <span class="kw">asp</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">motive_allinone</span>$<span class="no">file_sub_traj</span>))</pre></body></html></div>
<p><img src="data-import-cleaning_files/figure-html/all-in-one-1.png" width="700"></p>
<p>That’s all!</p>
<p>🐢</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://melissasarmstrong.com">Melissa S. Armstrong</a>, <a href="https://www.vikram-baliga.com/">Vikram B. Baliga</a>, <a href="https://www.grad.ubc.ca/campus-community/meet-our-students/press-eric">Eric R. Press</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
